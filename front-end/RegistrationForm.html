<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="RegistrationFormStyles.css">
  <title>Registration form</title>
</head>

<section class = "container">
  <header>
    <div>
      <h1>Registration form</h1>
    </div>
  </header>

  <body>
  <form id="login-form">
    <input type="text" id="user-name" placeholder="Login" required class = "input">
    <br>
    <input type="password" id="user-password" placeholder="Password" required class = "input">
    <br>
    <input type="password" id="confirm-password" placeholder="Confirm password" required class = "input"><br>
    <button class = "first-button" type="button" id="submit">LOGIN</button>
    <button class = "second-button" type="button" id="login">REGISTER</button>
  </form>
</section>

<script>
  function applyBindings(){
    document.getElementById("register").addEventListener("click", function (){
      get_user_data(true)
    })

    document.getElementById("login").addEventListener("click", function (){
      get_user_data(false)
    })
  }

  applyBindings()

  function clear_form(){
    document.getElementById("user-name").value = "";
    document.getElementById("user-password").value = "";
    document.getElementById("confirm-password").value = "";
  }

  function get_user_data(register) {
    login = document.getElementById("user-name").value
    password = document.getElementById("user-password").value
    confirmPassword = document.getElementById("confirm-password").value

    // validate password
    if (password !== confirmPassword) {
      clear_form()
      alert("Password doesn't match")
      return false;
    }

    var xhr = new XMLHttpRequest()
    var url

    if (register){
      url = "/login/register"
    }
    else{
      url = "/login"
    }

    xhr.open("POST", url, true)
    xhr.setRequestHeader("Content-Type", "application/json")
    var data = JSON.stringify({"login": login, "password": password})
    xhr.send(data)

    clear_form()
  }

</script>
</body>
</html>